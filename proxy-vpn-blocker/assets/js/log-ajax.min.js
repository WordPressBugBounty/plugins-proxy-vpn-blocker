function timeAgo(timestamp){const targetDate=new Date(timestamp+"Z"),now=new Date,secondsAgo=Math.floor((now-targetDate)/1e3),minutes=Math.floor(secondsAgo/60),hours=Math.floor(minutes/60),days=Math.floor(hours/24),weeks=Math.floor(days/7);let months=now.getMonth()+12*now.getFullYear()-(targetDate.getMonth()+12*targetDate.getFullYear());now.getDate()<targetDate.getDate()&&months--;const years=Math.floor(months/12);return months%=12,secondsAgo<1?"Now":secondsAgo<60?`${secondsAgo} second${1===secondsAgo?"":"s"} ago`:minutes<60?`${minutes} minute${1===minutes?"":"s"} ago`:hours<24?`${hours} hour${1===hours?"":"s"} ago`:days<7?`${days} day${1===days?"":"s"} ago`:weeks<4?`${weeks} week${1===weeks?"":"s"} ago`:0===months&&days>=28?"1 month ago":months<12?`${months} month${1===months?"":"s"} ago`:`${years} year${1===years?"":"s"} ago`}function convertToLocalTime(utcTimestamp){const date=new Date(utcTimestamp),localTimeString=date.toLocaleString();return localTimeString}jQuery(document).ready((function($){let currentPage=1,isRefreshing=!1,refreshInterval,isMouseInGrid=!1;function loadLogs(page=1){if(isRefreshing)return;isRefreshing=!0;const openRows=[];$(".extra-data-row:visible").each((function(){const rowId=$(this).prev(".angry-grid").attr("data-log-id");openRows.push(rowId)})),$.ajax({url:pvb_action_logs.ajax_url,type:"POST",dataType:"json",data:{action:"fetch_pvb_logs",nonce:pvb_action_logs.nonce,page:page},success:function(response){response.success?($(".log_content").empty(),$.each(response.data,(function(index,log){const imagePath=pvb_action_logs.flags_url,countryCode=log.country_iso,flagPath=`${imagePath}${countryCode}.png`;let proxyType="VPN"===log.detected_type?"type_vpn":"type_others",logHtml='<div class="angry-grid" data-log-id="'+log.id+'"><div class="item-0" title="'+log.blocked_at_wp+'"><span class="space">'+timeAgo(log.blocked_at)+'</span></div><div class="item-1"><span><a href="https://proxycheck.io/threats/'+log.ip_address+'" target="_blank">'+log.ip_address+'</a></span></div><div class="item-2"><span><img class="country-flag" alt="'+log.country+' flag" title="'+log.country+'" src="'+flagPath+'"><span>'+log.country+" ("+log.country_iso+')</span></span></div><div class="item-3"><span>'+log.risk_score+'</span></div><div class="semi-circle" style="display: none;"><i class="fa-fw fa-solid fa-angle-down"></i></div></div><div class="extra-data-row"><div class="extra-data-row-content"><span class="space ipinflux_'+proxyType+'">'+log.detected_type+'</span><span class="space ipinflux_blocked_on_url" alt="'+log.blocked_url+'">URL: '+log.blocked_url+"</span>";log.api_type&&(logHtml+='<span class="space ipinflux_api_type_used" alt="'+log.api_type+'">Processed By: '+log.api_type+"</span>"),logHtml+='<div class="log-whitelist-btn"><button class="add-to-whitelist-btn" data-ip="'+log.ip_address+'"><i class="fa-solid fa-plus"></i> Whitelist IP</button></div>',logHtml+="</div></div>",$(".log_content").append(logHtml)})),openRows.forEach((function(rowId){const $angryGrid=$(`.angry-grid[data-log-id="${rowId}"]`);$angryGrid.length&&($angryGrid.next(".extra-data-row").show(),$angryGrid.find(".semi-circle").fadeIn("slow"))})),currentPage=page):$("#log-container").html("<span>No logs found</span>")},error:function(){$("#log-container").html("<span>Error loading logs</span>")},complete:function(){isRefreshing=!1}})}$(".log_content").on("click",".angry-grid",(function(){if(isRefreshing)return;const extraDataRow=$(this).next(".extra-data-row"),semiCircle=$(this).find(".semi-circle");extraDataRow.is(":visible")?semiCircle.fadeOut("fast"):semiCircle.fadeIn("fast"),extraDataRow.slideToggle("slow")})),loadLogs(currentPage),$("#prev-page").click((function(){loadLogs(currentPage+1)})),$("#next-page").click((function(){currentPage>1&&loadLogs(currentPage-1)})),$(".angry-grid").on("mouseenter",(function(){isMouseInGrid=!0})).on("mouseleave",(function(){isMouseInGrid=!1})),refreshInterval=setInterval((function(){isMouseInGrid||loadLogs(currentPage)}),15e3)})),jQuery((function($){$(document).on("click",".add-to-whitelist-btn",(function(e){e.preventDefault();const ip=$(this).data("ip"),$btn=$(this);$.ajax({url:pvb_action_logs.ajax_url,type:"POST",data:{action:"whitelist_add",nonce_add_ip_whitelist:pvb_action_logs.whitelist_nonce,add:ip},success:function(response){"false"===response.success?$btn.text("✖ Access Denied by proxycheck.io").prop("disabled",!0):$btn.text("✔ Successfully Whitelisted").prop("disabled",!0)},error:function(xhr,status,error){$btn.text("✖ Failed").addClass("error")}})}))}));